<style>
    .form_to_add_stuffs,#implementCodeForm {
        padding: 2.5em;
        border-radius: 15px;
        display: flex;
        gap: 1em;
        flex-direction: column;
        color: #2c3e50;
        background: white;
        position: relative;
        max-width: 95%;
        max-height: 95%;
        top: 15px;
        overflow: auto;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        margin: 0 auto;
        z-index: 100;
    }

    #close {
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 1.2em;
        border-radius: 50%;
        padding: 0.5em;
        cursor: pointer;
        color: #e74c3c;
        transition: all 0.2s ease;
    }

    #close:hover {
        transform: scale(1.2) rotate(90deg);
        color: #c0392b;
    }

    #Title {
        text-align: center;
        color: #2c3e50;
        font-size: 1.8em;
        margin-bottom: 1em;
        border-bottom: 2px solid #3498db;
        padding-bottom: 0.5em;
    }

    .form-group {
        width: 100%;
        display: flex;
        flex-direction: column;
        margin: 0.5em 0;
        position: relative;
    }
    .smallButtons{
        flex-direction: row;
        gap: 1em;
    }
    .form-group label {
        color: #34495e;
        font-size: 0.9em;
        margin-bottom: 0.3em;
        font-weight: 500;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        border-color: #3498db;
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        outline: none;
    }

    .form-group input[type="number"] {
        width: 100px;
    }

    .fieldset-container {
        background: #f8f9fa;
        padding: 1.5em;
        border-radius: 10px;
        border: 1px solid #e9ecef;
        margin-top: 1.5em;
        position: relative;
        max-height: 90vh;
        overflow: auto;
    }

    .fieldset-header {
        position: absolute;
        top: -0.3em;
        left: 0.3em;
        background: #3498db;
        color: white;
        padding: 0.3em 0.8em;
        border-radius: 5px;
        font-size: 0.9em;
        z-index: 99;
    }

    .numbers {
        display: flex;
        gap: 1em;
        padding: 1em;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        position: relative;
        margin-bottom: 1em;
    }

    .allDetails {
        display: grid;
        grid-template-columns: repeat(4,1fr);
        gap: 1.5em;
        margin-top: 1.5em;
    }

    .detail {
        display: none;
        background: white;
        padding: 0.5em 1em;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        border: 1px solid #e9ecef;
    }

    .detail .form-group {
        margin: 0.2em 0;
    }


    .detail h4 {
        color: #3498db;
        margin-bottom: 1em;
        padding-bottom: 0.5em;
        border-bottom: 1px solid #eee;
    }

    .buttons-group {
        width: 100%;
        margin-top: 1em;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 1em;
    }

    .buttons-group button {
        padding: 0.8em 2em;
        border-radius: 8px;
        border: none;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .buttons-group button[type="reset"] {
        background: #e74c3c;
        color: white;
    }

    .buttons-group button[type="submit"] {
        background: #3498db;
        color: white;
    }

    .buttons-group button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .buttons-group button:active {
        transform: translateY(0);
    }

    .preview-container {
        margin-top: 2em;
        padding: 1em;
        background: #f8f9fa;
        border-radius: 10px;
        border: 1px solid #e9ecef;
    }

    .preview-container h3 {
        color: #2c3e50;
        margin-bottom: 1em;
        padding-bottom: 0.5em;
        border-bottom: 1px solid #3498db;
    }

    .form-preview {
        background: white;
        padding: 1.5em;
        border-radius: 8px;
        max-height: 90vh;
        overflow: auto;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        #form_to_add_stuffs {
            padding: 1.5em;
            max-width: 95%;
        }

        .numbers {
            grid-template-columns: 1fr;
        }

        .allDetails {
            grid-template-columns: 1fr;
        }

        .buttons-group {
            flex-direction: column;
            width: 100%;
        }

        .buttons-group button {
            width: 100%;
        }
    }
</style>
<form action="" method="post" class="form_to_add_stuffs">
    <div class="form_card_header">
        <label id="close" onclick="remove_form('form_to_add_card')"><i class="fas fa-close"></i></label>
        <h2 id="Title">Add Form Card</h2>
    </div>    
    <div class="form-group">
        <label for="T1">Heading & Position</label>
        <div class="input-group">
            <input type="text" name="headingOfForm" id="T1" placeholder="Enter form heading (e.g., Contact Form)" class="form-control" required/>
            <input type="number" name="containerPosForm" id="containerPosForm" class="form-control" placeholder="Container-Position" style="max-width: 8em" value="0">
        </div>
    </div>
    <div >
        <label for="formMethod">Select a method:</label>
        <div class="form-group smallButtons">
            <input type="radio" name="formMethod" id="GETMethod" value="GET" checked>
            <label for="GETMethod">GET (Fast)</label>
        </div>
        <div class="form-group smallButtons">
            <input type="radio" name="formMethod" id="POSTMethod" value="POST">
            <label for="POSTMethod">POST (Secure)</label>
        </div>  
    </div>
    
    <div class="form-group">
        <label for="F9">Enter the Block names ( Fieldsets-legends ) using Enter (↩) key</label>
        <textarea name="headingsOfFieldsetForm" id="T11" min="0" placeholder="e.g., Home Address
        Work Address" oninput="generateFieldsets(this.value,'fieldsetsContainerForm')" class="form-control"></textarea>
    </div>
    
    <div id="fieldsetsContainerForm">
    </div>
    
    <div class="preview-container">
        <h3>Form Preview</h3>
        <div id="formPreview" class="form-preview">
            <p>Your form preview will appear here</p>
        </div>
    </div>
    
    <div class="buttons-group">
        <button type="button" onclick="resetForm('fieldsetsContainerForm')">Reset</button>
        <button type="button" onclick="generateFormCode(document.getElementById('containerPosForm').value)">Generate Form Code</button>
    </div>
</form>

<div id="templates" hidden>
    <div class="detail" id="inputTemplate">
        <h5>Input</h5>
        <div class="form-group">
            <label for="">Type</label>
            <select name="inputType" class="form-control">
                <option value="text">Text</option>
                <option value="email">Email</option>
                <option value="password">Password</option>
                <option value="file">File</option>
                <option value="number">Number</option>
                <option value="search">Search</option>
                <option value="hidden">Hidden</option>
                <option value="color">Color</option>
                <option value="date">Date</option>
                <option value="datetime">Datetime</option>
                <option value="month">Month</option>
                <option value="week">Week</option>
                <option value="time">Time</option>
                <option value="url">Url</option>
                <option value="tel">Tel</option>
            </select>
        </div>
        <div class="form-group-sm">
            <label>Placeholder</label>
            <input type="text" name="inputPlaceholder" placeholder="Enter placeholder text" class="form-control">
        </div>
        <div class="form-group">
            <label for='logicalNameInp'>Logical name</label>
            <input type="text" name="inputName" id="logicalNameInp" class="lnInp" required placeholder="Enter name attribute for input" oninput="toVarName(this.className,' ','_')">
        </div>
        <div class="form-group smallButtons">
            <label for="reqOrNOt">Required</label>
            <input type="checkbox" name="requiredInp" id="reqForInp" value="inpReqTrue" >
        </div>
         <div class="form-group">
            <label>Label Text</label>
            <input type="text" name="inputLabel" placeholder="Enter label for input">
        </div>
    </div>

    <div class="detail" id="textareaTemplate">
        <h5>Textarea</h5>
        <div class="form-group">
            <label>Placeholder</label>
            <input type="text" name="textareaPlaceholder" placeholder="Enter placeholder text">
        </div>
        <div class="form-group">
            <label for="logicalNameTextarea">Logical name</label>
            <input type="text" name="textareaName" id="logicalNameTextarea" class="lnTexta" required placeholder="Enter name attribute for textarea" oninput="toVarName(this.className,' ','_')">
        </div>
        <div class="form-group">
            <label>Rows</label>
            <input type="number" name="textareaRows" value="4" min="1" placeholder="Number of rows">
        </div>
        <div class="form-group smallButtons">
            <label for="reqForTextarea">Required</label>
            <input type="checkbox" id="reqForTextarea" name="requiredTextarea" value="textaReqTrue">
        </div>
        <div class="form-group">
            <label>Label Text</label>
            <input type="text" name="textareaLabel" placeholder="Enter label for textarea">
        </div>
    </div>

    <div class="detail" id="selectTemplate">
        <h5>Select Tag</h5>
        <div class="form-group">
            <label>Options separated by comma( , )</label>
            <textarea name="selectOptions" placeholder="e.g., Small, Medium, Large" required></textarea>
        </div>
        <div class="form-group">
            <label id="logicalNameSelect">Logical name</label>
            <input type="text" name="selectName" id="logicalNameSelect" class="lnSel" required placeholder="Enter name attribute for select" oninput="toVarName(this.className,' ','_')">
        </div>
        <div class="form-group smallButtons">
            <label for="reqForSelect">Required</label>
            <input type="checkbox" id="reqForSelect" name="requiredSelect" value="selectReqTrue">
        </div>
        <div class="form-group">
            <label>Label Text</label>
            <input type="text" name="selectLabel"   placeholder="Enter label for select">
        </div>
    </div>

    <div class="detail" id="radioTemplate">
        <h5>Radio Button</h5>
        <div class="form-group">
            <label>Options separated by comma( , )</label>
            <textarea name="radioOptions" placeholder="e.g., Male, Female, Other" required></textarea>
        </div>
        <div class="form-group">
            <label  for="logicalNameRadio" >Logical name</label>
            <input type="text" name="radioName" id="logicalNameRadio" class="lnRad" required placeholder="Enter name attribute for radio group" oninput="toVarName(this.className,' ','_')">
        </div>
        <div class="form-group smallButtons">
            <label for="reqForRadio">Required</label>
            <input type="checkbox" id="reqForRadio" name="requiredRadio" value="radioRwqTrue">
        </div>
        <div class="form-group">
            <label>Label Text</label>
            <input type="text" name="radioLabel" placeholder="Enter label for radio group">
        </div>
    </div>

    <div class="detail" id="checkboxTemplate">
        <h5>Checkbox</h5>
        <div class="form-group">
            <label>Options separated by comma( , )</label>
            <textarea name="checkboxOptions" placeholder="e.g., Swimming, Reading, Gaming" required></textarea>
        </div>
        <div class="form-group">
            <label for="logicalNamecheckbox">Logical name</label>
            <input type="text" name="checkboxName" id="logicalNamecheckbox" class="lnCheck" required placeholder="Enter name attribute for checkbox group" oninput="toVarName(this.className,' ','_')">
        </div>
        <div class="form-group">
            <label>Label Text</label>
            <input type="text" name="checkboxLabel" placeholder="Enter label for checkbox group">
        </div>
    </div>

    <div class="detail" id="buttonTemplate">
        <h5>Button</h5>
        <div class="form-group">
            <label>Type</label>
            <select name="buttonType">
                <option value="button">Button</option>
                <option value="submit">Submit</option>
                <option value="reset">Reset</option>
                <option value="disabled">disabled</option>
            </select>
        </div>
        <div class="form-group">
            <label>Text</label>
            <input type="text" name="buttonText" required placeholder="Enter button text (e.g., Submit, Save)" />
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const inputs = document.getElementsByTagName('input');
        for (let input of inputs) {
            if (input && input.required) {
                const id = input.getAttribute('id');
                const label = document.querySelector(`label[for='${id}']`);
                if (label) {
                    label.innerHTML += ` <span style="color: red;">*</span>`;
                }
            }
        }
	});
    let legends;
    function generateFieldsets(legend,container) {
        const fieldsetsContainer = document.getElementById(container);
        fieldsetsContainer.innerHTML = '';
        const legendList = legend.trim().split('\n')
        legends = legendList

        for (let i = 1; i <= legends.length; i++) {
            const fieldsetDiv = document.createElement('div');
            fieldsetDiv.className = 'fieldset-container';
            if(container === 'fieldsetsContainerTab'){
                fieldsetDiv.id = `Table-${i}`;
                fieldsetDiv.innerHTML = `
                    <div class="fieldset-header">${legends[i-1]}</div>
                     <div class="form-group">
                        <select name="typeOfTable${i}" id="typeOfTab${i}" oninput='updatePreviewTab('tablePreview')'>
                            <option value="hAtTop">Header(s) at the Top</option>
                            <option value="hAtLeft">Header(s) at The Left</option>
                            <option value="hBoth">Header(s) at AT The Left and Top </option>
                        </select>
                    </div>
                    <div class="form-group" id="normal_headers${i}" >
                        <label for="F3${i}">Headers of table ( , ) separated</label>
                        <textarea name="headersOfTab${i}" id="F3${i}" oninput="updatePreviewTab('tablePreview')" ></textarea>
                    </div>                
                    <div class="form-group" id="numberOfRows${i}">
                        <label for="F4${i}">Number Of data Rows</label>
                        <input type="number" name="numOfRows${i}" id="F4${i}" min="0" oninput="generateTbody(this.value, ${i})"/>
                    </div>
                    <div class="form-group" id="top_headers${i}" style="display:none;">
                        <label for="top${i}">Top Headers of table (↩) separated</label>
                        <textarea name="topHeadersOfTab${i}" id="top${i}" oninput="updatePreviewTab('tablePreview')" ></textarea>
                    </div>  
                    <div class="form-group" id="left_headers${i}" style="display:none;" >
                        <label for="left${i}">Left Headers of table (↩) separated</label>
                        <textarea name="lefthHeadersOfTab${i}" id="left${i}" oninput="updatePreviewTab('tablePreview')" ></textarea>
                    </div>  
                    <div class="justContainer" style="display:flex; flex-direction:column;">
                        <div id="dataContainers${i}" style="overflow: auto;"></div>
                    </div>

                    <div class="form-group">
                        <label for="F5${i}">Footers of table ( , ) separated</label>
                        <textarea name="footersOfTab${i}" id="F5${i}" oninput="updatePreviewTab('tablePreview')" value=''></textarea>
                    </div>`
                fieldsetsContainer.appendChild(fieldsetDiv);
            }
            else if(container==='fieldsetsContainerForm'){
                fieldsetDiv.id = `fieldset-${i}`;
                fieldsetDiv.innerHTML = `
                    <div class="fieldset-header">${legends[i-1]}</div>
                    <div class="numbers">
                        <div class="form-group">
                            <label>Inputs</label>
                            <input type="number" min="0" value="0" oninput="generateElements(${i}, 'input', this.value)">
                        </div>
                        <div class="form-group">
                            <label>Textareas</label>
                            <input type="number" min="0" value="0" oninput="generateElements(${i}, 'textarea', this.value)" />
                        </div>
                        <div class="form-group">
                            <label>Select tags</label>
                            <input type="number" min="0" value="0" oninput="generateElements(${i}, 'select', this.value)" />
                        </div>
                        <div class="form-group">
                            <label>Radios</label>
                            <input type="number" min="0" value="0" oninput="generateElements(${i}, 'radio', this.value)" />
                        </div>
                        <div class="form-group">
                            <label>Checkboxes</label>
                            <input type="number" min="0" value="0" oninput="generateElements(${i}, 'checkbox', this.value)">
                        </div>
                        <div class="form-group">
                            <label>Buttons</label>
                            <input type="number" min="0" value="0" oninput="generateElements(${i}, 'button', this.value)">
                        </div>
                    </div>
                    <div id="elements-container-${i}" class="allDetails"></div>
                `;
                fieldsetsContainer.appendChild(fieldsetDiv)
                updatePreview('formPreview')

            }
        }
    }

    function generateElements(fieldsetId, elementType, count) {
        const container = document.getElementById(`elements-container-${fieldsetId}`);
        if (!container) return;
        
        const existingElements = container.querySelectorAll(`[data-type="${elementType}"]`);
        existingElements.forEach(el => el.remove());
        
        count = parseInt(count) || 0;
        if (count <= 0) return;
        
        const template = document.getElementById(`${elementType}Template`);
        if (!template) return;
        
        for (let i = 1; i <= count; i++) {
            const clone = template.cloneNode(true);
            clone.id = `${elementType}-${fieldsetId}-${i}`;
            clone.style.display = 'grid';
            clone.setAttribute('data-type', elementType);
            
            // Update the heading to include the index
            const heading = clone.querySelector('h4');
            if (heading) {
                heading.textContent = `${heading.textContent} ${i}`;
            }
            
            // Add unique names to all inputs to avoid conflicts
            const allInputs = clone.querySelectorAll('input, select, textarea');
            allInputs.forEach(input => {
                const originalName = input.getAttribute('name');
                if (originalName) {
                    input.setAttribute('name', `fieldset-${fieldsetId}-${elementType}-${i}-${originalName}`);
                }
            }); 
            
            container.appendChild(clone);
        }
        
        updatePreview('formPreview');
    }
    
    function updatePreview(id) {
        const preview = document.getElementById(id);
        if (!preview) return;
        
        const formHeading = document.getElementById('T1').value || 'Form Title';
        
        let previewHTML = `<h3>${formHeading}</h3>`;
    
        for (let i = 1; i <= legends.length; i++) {
            const fieldset = document.getElementById(`fieldset-${i}`);
            if (!fieldset) continue;
            
            if(legends.length>1) previewHTML += `<fieldset><legend>${legends[i-1]}</legend>`;
            
            const elementsContainer = document.getElementById(`elements-container-${i}`);
            if (elementsContainer) {
                const elements = elementsContainer.querySelectorAll('.detail');
                elements.forEach(el => {
                    const type = el.getAttribute('data-type');
                    previewHTML += generatePreviewElement(el, type);
                });
            }
            
            if(legends.length>1) previewHTML += `</fieldset>`;
        }
        
        preview.innerHTML = previewHTML;
    }
    
    function generatePreviewElement(element, type) {
        let html = '';

        switch (type) {
            case 'input': {
                const inputName = element.querySelector('input[name$="inputName"]')?.value || 'input';
                const inputLabel = element.querySelector('input[name$="inputLabel"]')?.value || 'Input Field';
                const inputType = element.querySelector('select[name$="inputType"]')?.value || 'text';
                const inputPlaceholder = element.querySelector('input[name$="inputPlaceholder"]')?.value || '';
                const inputRequired = element.querySelector('input[type="checkbox"][name$="requiredInp"]')?.checked;

                // Special handling for different input types
                let inputClass = "form-control";
                let wrapperClass = "mb-3";
                
                if (inputType === 'color') {
                    inputClass = "form-control form-control-color";
                } else if (inputType === 'range') {
                    inputClass = "form-range";
                } else if (inputType === 'file') {
                    inputClass = "form-control";
                    wrapperClass += " file-input-wrapper";
                }

                html = `<div class="${wrapperClass}">\n`;
                html += `\t<label for="${inputName}" class="form-label fw-semibold">${inputLabel}</label>\n`;
                html += `\t<input type="${inputType}" class="${inputClass}" name="${inputName}" id="${inputName}" placeholder="${inputPlaceholder}"${inputRequired ? ' required' : ''}>\n`;
                
                // Add help text for file inputs
                if (inputType === 'file') {
                    html += `\t<div class="form-text">Choose a file to upload.</div>\n`;
                }
                
                html += `</div>\n`;
                break;
            }

            case 'textarea': {
                const textareaName = element.querySelector('input[name$="textareaName"]')?.value || 'textarea';
                const textareaLabel = element.querySelector('input[name$="textareaLabel"]')?.value || 'Textarea';
                const textareaPlaceholder = element.querySelector('input[name$="textareaPlaceholder"]')?.value || '';
                const textareaRows = element.querySelector('input[name$="textareaRows"]')?.value || '4';
                const textareaRequired = element.querySelector('input[type="checkbox"][name$="requiredTextarea"]')?.checked;

                html = `<div class="mb-3">\n`;
                html += `\t<label for="${textareaName}" class="form-label fw-semibold">${textareaLabel}</label>\n`;
                html += `\t<textarea class="form-control" name="${textareaName}" id="${textareaName}" placeholder="${textareaPlaceholder}" rows="${textareaRows}"${textareaRequired ? ' required' : ''}></textarea>\n`;
                html += `</div>\n`;
                break;
            }

            case 'select': {
                const selectName = element.querySelector('input[name$="selectName"]')?.value || 'select';
                const selectLabel = element.querySelector('input[name$="selectLabel"]')?.value || 'Select Option';
                const selectOptions = element.querySelector('textarea[name$="selectOptions"]')?.value || '';
                const options = selectOptions.split(',').map(opt => opt.trim()).filter(opt => opt);
                const selectRequired = element.querySelector('input[type="checkbox"][name$="requiredSelect"]')?.checked;

                html = `<div class="mb-3">\n`;
                html += `\t<label for="${selectName}" class="form-label fw-semibold">${selectLabel}</label>\n`;
                html += `\t<select class="form-select" name="${selectName}" id="${selectName}"${selectRequired ? ' required' : ''}>\n`;
                html += `\t\t<option value="" selected disabled>Choose an option...</option>\n`;
                html += options.map(opt => `\t\t<option value="${opt.toLowerCase().replace(/ /g, '_')}">${opt}</option>`).join('\n') + '\n';
                html += `\t</select>\n`;
                html += `</div>\n`;
                break;
            }

            case 'radio': {
                const radioName = element.querySelector('input[name$="radioName"]')?.value || 'radio';
                const radioLabel = element.querySelector('input[name$="radioLabel"]')?.value || 'Radio Options';
                const radioOptions = element.querySelector('textarea[name$="radioOptions"]')?.value || '';
                const radioOptionsList = radioOptions.split(',').map(opt => opt.trim()).filter(opt => opt);
                const radioRequired = element.querySelector('input[type="checkbox"][name$="requiredRadio"]')?.checked;

                html = `<div class="mb-3">\n`;
                html += `\t<label class="form-label fw-semibold">${radioLabel}</label>\n`;
                
                // Use row and col for responsive radio layout
                html += `\t<div class="row g-2">\n`;
                html += radioOptionsList.map(opt => {
                    const optionId = `${radioName}-${opt.toLowerCase().replace(/ /g, '-')}`;
                    return `\t\t<div class="col-md-4 col-sm-6">\n\t\t\t<div class="form-check">\n\t\t\t\t<input class="form-check-input" type="radio" name="${radioName}" value="${opt.toLowerCase().replace(/ /g, '_')}" id="${optionId}"${radioRequired ? ' required' : ''}>\n\t\t\t\t<label class="form-check-label" for="${optionId}">${opt}</label>\n\t\t\t</div>\n\t\t</div>`;
                }).join('\n') + '\n';
                html += `\t</div>\n`;
                html += `</div>\n`;
                break;
            }

            case 'checkbox': {
                const checkboxName = element.querySelector('input[name$="checkboxName"]')?.value || 'checkbox';
                const checkboxLabel = element.querySelector('input[name$="checkboxLabel"]')?.value || 'Checkbox Options';
                const checkboxOptions = element.querySelector('textarea[name$="checkboxOptions"]')?.value || '';
                const checkboxOptionsList = checkboxOptions.split(',').map(opt => opt.trim()).filter(opt => opt);

                html = `<div class="mb-3">\n`;
                html += `\t<label class="form-label fw-semibold">${checkboxLabel}</label>\n`;
                
                // Use row and col for responsive checkbox layout
                html += `\t<div class="row g-2">\n`;
                html += checkboxOptionsList.map(opt => {
                    const optionId = `${checkboxName}-${opt.toLowerCase().replace(/ /g, '-')}`;
                    return `\t\t<div class="col-md-4 col-sm-6">\n\t\t\t<div class="form-check">\n\t\t\t\t<input class="form-check-input" type="checkbox" name="${checkboxName}[]" value="${opt.toLowerCase().replace(/ /g, '_')}" id="${optionId}">\n\t\t\t\t<label class="form-check-label" for="${optionId}">${opt}</label>\n\t\t\t</div>\n\t\t</div>`;
                }).join('\n') + '\n';
                html += `\t</div>\n`;
                html += `</div>\n`;
                break;
            }

            case 'button': {
                const buttonType = element.querySelector('select[name$="buttonType"]')?.value || 'button';
                const buttonText = element.querySelector('input[name$="buttonText"]')?.value || 'Button';

                // Determine button style based on type
                let buttonClass = "btn-primary";
                if (buttonType === 'reset') buttonClass = "btn-outline-secondary";
                if (buttonType === 'disabled') buttonClass = "btn-secondary disabled";

                html = `<div class="mb-3">\n`;
                html += `\t<button type="${buttonType}" class="btn ${buttonClass} px-4 py-2">${buttonText}</button>\n`;
                html += `</div>\n`;
                break;
            }
        }

        return html;
    }

    function generateFormCode(pos) {
        const formHeading = document.getElementById('T1').value || 'Form Title';
        const methodRadio = document.getElementsByName('formMethod');
        let method = "GET";
        for (const rad of methodRadio) {
            if (rad.checked) method = rad.value;
        }

        // Enhanced container with proper Bootstrap classes
        let formHTML = `<div class="${pos} container my-5">\n`;
        formHTML += `\t<div class="row justify-content-center">\n`;
        formHTML += `\t\t<div class="col-12 col-lg-10 col-xl-8">\n`;
        formHTML += `\t\t\t<div class="card shadow-sm border-0">\n`;
        formHTML += `\t\t\t\t<div class="card-header bg-primary text-white py-3">\n`;
        formHTML += `\t\t\t\t\t<h1 class="h3 mb-0 text-center"><i class="fas fa-form me-2"></i>${formHeading}</h1>\n`;
        formHTML += `\t\t\t\t</div>\n`;
        formHTML += `\t\t\t\t<div class="card-body p-4 p-md-5">\n`;
        formHTML += `\t\t\t\t\t<form action="#" method="${method}" id="${formHeading.replace(/ /g, "_")}" class="needs-validation" novalidate>\n`;

        for (let i = 1; i <= legends.length; i++) {
            const fieldset = document.getElementById(`fieldset-${i}`);
            if (!fieldset) continue;

            if (legends.length > 1) {
                formHTML += `\t\t\t\t\t\t<fieldset class="mb-4 p-4 border rounded-3 bg-light">\n`;
                formHTML += `\t\t\t\t\t\t\t<legend class="h5 fw-semibold text-primary mb-3 px-2"><i class="fas fa-layer-group me-2"></i>${legends[i-1]}</legend>\n`;
            }

            const elementsContainer = document.getElementById(`elements-container-${i}`);
            if (elementsContainer) {
                const elements = elementsContainer.querySelectorAll('.detail');
                elements.forEach(el => {
                    const type = el.getAttribute('data-type');
                    formHTML += '\t\t\t\t\t\t' + generatePreviewElement(el, type).replace(/\n/g, '\n\t\t\t\t\t\t') + '\n';
                });
            }

            if (legends.length > 1) formHTML += '\t\t\t\t\t\t</fieldset>\n';
        }

        // Add submit button if not already added
        formHTML += `\t\t\t\t\t\t<div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4 pt-3 border-top">\n`;
        formHTML += `\t\t\t\t\t\t\t<button type="reset" class="btn btn-outline-secondary me-md-2">Reset Form</button>\n`;
        formHTML += `\t\t\t\t\t\t\t<button type="submit" class="btn btn-success px-4"><i class="fas fa-paper-plane me-2"></i>Submit Form</button>\n`;
        formHTML += `\t\t\t\t\t\t</div>\n`;

        formHTML += `\t\t\t\t\t</form>\n`;
        formHTML += `\t\t\t\t</div>\n`;
        formHTML += `\t\t\t</div>\n`;
        formHTML += `\t\t</div>\n`;
        formHTML += `\t</div>\n`;
        formHTML += `</div>\n`;

        // Add validation script
        formHTML += `\n<!-- Bootstrap Form Validation Script -->\n`;
        formHTML += `<script>\n`;
        formHTML += `// Bootstrap form validation\n`;
        formHTML += `(function () {\n`;
        formHTML += `  'use strict'\n`;
        formHTML += `  var forms = document.querySelectorAll('.needs-validation')\n`;
        formHTML += `  Array.prototype.slice.call(forms)\n`;
        formHTML += `    .forEach(function (form) {\n`;
        formHTML += `      form.addEventListener('submit', function (event) {\n`;
        formHTML += `        if (!form.checkValidity()) {\n`;
        formHTML += `          event.preventDefault()\n`;
        formHTML += `          event.stopPropagation()\n`;
        formHTML += `        }\n`;
        formHTML += `        form.classList.add('was-validated')\n`;
        formHTML += `      }, false)\n`;
        formHTML += `    })\n`;
        formHTML += `})()\n</scrip`;
        formHTML += 't>'
        const form = document.getElementById('implementCodeFormCont');
        const texta = document.getElementById("MainCode");
        form.style.display = 'flex';
        
        texta.value = formHTML;

        remove_form('form_to_add_card');
    }

    function resetForm(container) {
        if (confirm('Are you sure you want to reset the form? All your inputs will be lost.')) {
            document.getElementById('form_to_add_stuffs').reset();
            document.getElementById(container).innerHTML = '';
            document.getElementById('formPreview').innerHTML = '<p>Preview will appear here</p>';
            fieldsetCount = 0;
        }
    }
</script>