<form class="form_to_add_stuffs" action="#">
    <div class="form_card_header">
        <label id="close" onclick="remove_form('form_to_add_card')"><i class="fas fa-close"></i></label>
        <h2 id="Title">Add Blog Card</h2>
    </div>
    <div class="form-group">
        <label for="B1">The heading(s) of Content using Enter (â†©) key</label>  
        <div class="input-group">
            <textarea  name="headingsOfBlog" id="B1" oninput="generateHeadings(this.value, 'fieldsetsContainerBlog')" placeholder="e.g., Essay on India
        About Me & More" class="form-control"></textarea> 
            <input type="number" name="containerPosBlog" id="containerPosBlog" class="form-control" placeholder="Container-Position" style="max-width: 5em" value="0">
        </div>
    </div>

    <div id="fieldsetsContainerBlog">

    </div>
    <div class="preview-container">
        <h3>Content Preview</h3>
        <div id="blogPreview" class="form-preview">
            <p>Your content preview will appear here</p>
        </div>
    </div>
    <div class="buttons-group">
        <button type="button" onclick="resetForm('fieldsetsContainerBlog')">Reset</button>
        <button type="button" onclick="generateCode('blogPreview', 'Content',  document.getElementById('containerPosBlog').value)">Generate Content Code</button>
    </div> 
</form>
<script>
    function generateHeadings(headings, container){
        const headingList = headings.trim().split('\n')
        if(headingList){
            const contentContainer = document.getElementById(container)
            contentContainer.innerHTML = ""
            
            for(let i=1; i<= headingList.length; i++){
                headingList[i-1] = headingList[i-1].replace(/ /gi,"_")
                html = `
                    <div class='fieldset-container' id='contentTemplate-${i}'>
                        <div class="form-field-sm smallButtons">
                            <label for="${headingList[i-1]}_noSubHead">No Sub headings</label>
                            <input type="checkbox" name="${headingList[i-1]}_noSubHeading" id="${headingList[i-1]}_noSubHead" onchange="checkNoSubHeadings('${headingList[i-1]}_noSubHead', '${headingList[i-1]}_subHeadingsGroup','${headingList[i-1]}_contentGroup')" checked />
                        </div>
                        <div class="fieldset-header">${headingList[i-1].replace(/_/gi," ")}</div>
                        <div class="form-field-sm" id="${headingList[i-1]}_contentGroup">
                            <label for="${headingList[i-1]}_contents">Content of ${headingList[i-1]}</label>
                            <textarea  name="${headingList[i-1]}_content" id="${headingList[i-1]}_contents" oninput="updatePreviewBlog('blogPreview')" rows='5' ></textarea>   
                        </div>   
                        <div class="form-field-sm" style='display: none;' id='${headingList[i-1]}_subHeadingsGroup'>
                            <label for="${headingList[i-1]}_subheadings">Sub-heading(s) of ${headingList[i-1]} separedted by (â†©)</label>
                            <textarea  name="${headingList[i-1]}_subheadings" id="${headingList[i-1]}_subheadings"  placeholder="e.g., Introduction Culture History ..." oninput="generateHeadings(this.value,'${headingList[i-1]}_sub-subheadingContainer'),updatePreviewBlog('blogPreview')"></textarea>   
                        </div>
                        <div class="form-field-sm" id='${headingList[i-1]}_widthGroup'>
                            <label for="${headingList[i-1]}_bWidth" class="form-label-sm">Width (%)</label>
                            <div class="input-group-sm d-flex">
                                <input id="${headingList[i-1]}_bWidth" class="form-control form-control-sm" type="range" min="25" max="100" step="25" value="75" oninput="updatePreviewBlog('blogPreview'), showSize('${headingList[i-1]}_bbWidth', this.value)">
                                <input type="number" id="${headingList[i-1]}_bbWidth" class="form-control form-control-sm" style="width: 5em;" disabled>
                            </div>
                        </div>
                        <div id='${headingList[i-1]}_sub-subheadingContainer' class='biggerContainer'></div>
                    </div>`

                contentContainer.innerHTML += html;
               
            }
            updatePreviewBlog('blogPreview')
        }
    }   
    function checkNoSubHeadings(buttonId, visible_cont=null, hide_cont=null){
        const radioB = document.getElementById(buttonId)
        const visible_container = document.getElementById(visible_cont)
        const hide_container = document.getElementById(hide_cont)
        const checked = radioB.checked
        if(!checked){
            visible_container.style.display = 'flex'
            hide_container.style.display = 'none'
        }
        else{
            visible_container.style.display = 'none'
            hide_container.style.display = 'flex'
        }
    }
    
    function updatePreviewBlog(pContainer) {
        const headings = document.getElementById('B1').value.trim();
        const headingList = headings.split('\n');
        const preview = document.getElementById(pContainer);
        preview.innerHTML = "";

        for (let i = 0; i < headingList.length; i++) {
            const mainHeading = headingList[i].trim().replace(/ /g, "_");
            const bWidth = document.getElementById(`${mainHeading}_bWidth`).value
            // ðŸŸ¢ Card structure for each main heading
            let cardHtml = `<section class="modern-text-container m-auto w-${bWidth}" id="${mainHeading}">\n\t<h2 class="text-primary">${headingList[i]}</h2>\n`;

            const contentOrSubhead = document.getElementById(`${mainHeading}_noSubHead`)?.checked;

            // ðŸ”¹ CASE 1: Direct content (no subheadings)
            if (contentOrSubhead) {
            const content = document.getElementById(`${mainHeading}_contents`)?.value || "Your dynamic content goes here";

            cardHtml += `\t<p id="${mainHeading}-Content">${content}</p>\n`;
            }

            // ðŸ”¹ CASE 2: Subheadings with content blocks
            else {
            const subheadingList = document.getElementById(`${mainHeading}_subheadings`)?.value.trim().split("\n") || [];
            cardHtml += `<div class="accordion accordion-flush" id="accordion-${mainHeading}">`;

            for (let j = 0; j < subheadingList.length; j++) {
                const sub = subheadingList[j].trim().replace(/ /g, "_");
                const subDisplay = subheadingList[j].trim();

                cardHtml += `
                <div class="accordion-item border-0 mb-2">
                    <h2 class="accordion-header" id="heading-${mainHeading}-${j}">
                    <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" 
                            data-bs-target="#collapse-${mainHeading}-${j}" aria-expanded="false" aria-controls="collapse-${mainHeading}-${j}">
                        ${subDisplay}
                    </button>
                    </h2>
                    <div id="collapse-${mainHeading}-${j}" class="accordion-collapse collapse" data-bs-parent="#accordion-${mainHeading}">
                    <div class="accordion-body bg-light text-muted border-start border-3 border-primary" id="${mainHeading}_${sub}">
                        Content for ${subDisplay}
                    </div>
                    </div>
                </div>`;
            }

            cardHtml += `</div>`; // close accordion
            }

            cardHtml += `</section> <!-- end card -->`;

            preview.innerHTML += cardHtml;
        }
    }
</script>
